steps:
  - script: choco install ninja
    displayName: Install Ninja

  - task: BatchScript@1
    displayName: Setup Visual C++ Environment
    inputs:
      filename: 'C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat'
      arguments: $(BuildPlatform) $(BuildWindowsSDK)
      modifyEnvironment: true

  - task: CMake@1
    displayName: Generate Ninja build
    inputs:
      workingDirectory: $(Build.BinariesDirectory)/$(BuildConfiguration)/$(BuildPlatform)
      cmakeArgs: -G Ninja -DCMAKE_BUILD_TYPE=$(BuildConfiguration) -DCMAKE_TOOLCHAIN_FILE=$(Build.SourcesDirectory)\CMake\toolchain.windows.cmake $(Build.SourcesDirectory)

  - task: CMake@1
    displayName: Build
    inputs:
      workingDirectory: $(Build.BinariesDirectory)/$(BuildConfiguration)/$(BuildPlatform)
      cmakeArgs: --build .

  - task: CMake@1
    displayName: Create distribution
    inputs:
      workingDirectory: $(Pipeline.Workspace)
      cmakeArgs: --install $(Build.BinariesDirectory)/$(BuildConfiguration)/$(BuildPlatform) --prefix dist --component dist
