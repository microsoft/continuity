steps:
  - task: CopyFiles@2
    displayName: Stage headers, nuspec
    condition: and(eq(variables.BuildConfiguration, 'Debug'), eq(variables.BuildPlatform, 'x86'))
    inputs:
      targetFolder: $(Build.ArtifactStagingDirectory)
      contents: |
        Continuity.nuspec
        include/**

  - task: CopyFiles@2
    displayName: Stage library
    inputs:
      sourceFolder: $(Build.BinariesDirectory)/$(BuildConfiguration)/$(BuildPlatform)/src/Continuity
      targetFolder: $(Build.ArtifactStagingDirectory)/$(BuildConfiguration)/$(BuildPlatform)
      contents: |
        Continuity.dll
        Continuity.lib
        Continuity.pdb

  - script: copy /y Continuity.$(BuildPlatform).def $(Build.ArtifactStagingDirectory)\$(BuildConfiguration)\$(BuildPlatform)\Continuity.def
    displayName: Stage library def
    workingDirectory: $(Build.SourcesDirectory)/src/Continuity

  - task: PublishPipelineArtifact@1
    displayName: Publish artifacts
    inputs:
      path: $(Build.ArtifactStagingDirectory)
      artifactName: Windows-$(BuildConfiguration)-$(BuildPlatform)
